# Requirements Document

## Introduction

AI日記自動生成機能は、ユーザーがその日の出来事や感情を簡潔に入力するだけで、AIが自動的に日記形式の文章を生成する機能です。この機能により、日記を書くことへの心理的ハードルを下げ、継続的な記録習慣の定着を支援します。

ユーザーは箇条書きやキーワードベースで情報を入力し、AIがそれを自然な文章に変換します。生成された日記は編集可能で、ユーザーの好みに合わせてカスタマイズできます。

## Requirements

### Requirement 1: 日記入力インターフェース
**Objective:** ユーザーとして、その日の出来事や感情を簡単に入力できるインターフェースが欲しい。そうすることで、日記を書く時間と労力を最小限に抑えられる。

#### Acceptance Criteria

1. WHEN ユーザーが「新規日記作成」ボタンをクリックした THEN システムは日記入力フォームを表示する
2. WHERE 日記入力フォーム内 THE システムは日付選択フィールドを提供する
3. WHERE 日記入力フォーム内 THE システムはマルチラインテキスト入力エリアを提供する
4. WHEN ユーザーがテキスト入力エリアに1文字以上のテキストを入力した THEN システムは「AI生成」ボタンを有効化する
5. IF テキスト入力エリアが空である THEN システムは「AI生成」ボタンを無効化する
6. WHERE テキスト入力エリア THE システムは文字数カウント表示を提供する
7. WHERE テキスト入力エリア THE システムはプレースホルダーテキスト「今日あった出来事や感じたことを簡潔に入力してください。AIがこの内容を元に日記を生成します。」を表示する

### Requirement 2: AI日記生成機能
**Objective:** ユーザーとして、簡潔な入力からAIが自然な日記文章を生成してほしい。そうすることで、文章を考える負担なく充実した日記を作成できる。

#### Acceptance Criteria

1. WHEN ユーザーが「AI生成」ボタンをクリックした THEN システムはユーザー入力内容をAI APIに送信する
2. WHILE AI生成処理中 THE システムはローディングインジケータを表示する
3. WHILE AI生成処理中 AND 15秒以上経過した THE システムは処理時間を秒単位で表示する（例：「処理中... (18秒)」）
4. WHEN AI APIから生成結果を受信した THEN システムは生成された日記文章をプレビューエリアに表示する
5. WHERE 生成された日記文章 THE システムは適切な段落構成（導入、本文、結び）を含める
6. WHERE プレビューエリア THE システムは青色の背景（bg-blue-50）で生成結果を強調表示する
7. WHEN AI生成が完了した THEN システムは「採用」ボタンと「再生成」ボタンを表示する
8. IF AI API呼び出しがエラーを返した THEN システムはエラーメッセージと「再試行」ボタンを表示する
9. WHERE エラー表示 THE システムは赤色の背景（bg-red-50）でエラーを強調表示する
10. WHEN AI生成処理が30秒を超えた THEN システムはタイムアウトエラー「日記の生成がタイムアウトしました。もう一度お試しください。」を表示する

### Requirement 3: 生成結果の編集と保存
**Objective:** ユーザーとして、AI生成された日記を自分好みに編集し、保存できるようにしたい。そうすることで、自分の声を反映した日記に仕上げられる。

#### Acceptance Criteria

1. WHEN ユーザーが「採用」ボタンをクリックした THEN システムは生成された日記文章を編集可能なエディタに転送する
2. WHERE 日記エディタ THE システムはマルチラインテキスト編集機能を提供する
3. WHERE 日記エディタ THE システムは文字数カウント表示を提供する
4. WHEN ユーザーが日記内容を編集した THEN システムはリアルタイムで変更を反映する
5. WHEN ユーザーが「保存」ボタンをクリックした THEN システムは日記をデータベースに保存する
6. IF 日記保存が成功した THEN システムは日記一覧ページにリダイレクトする
7. IF 日記保存が失敗した THEN システムはエラーメッセージ「保存に失敗しました。再度お試しください。」を表示する
8. WHEN ユーザーが「再生成」ボタンをクリックした THEN システムは元の入力内容を保持したまま、新しい日記文章をAI生成する
9. IF 日記本文エディタまたはユーザー入力エリアが空である THEN システムは「保存」ボタンを無効化する

### Requirement 4: 日記データ管理
**Objective:** ユーザーとして、生成・保存した日記を確実に管理したい。そうすることで、データの損失リスクを最小化できる。

#### Acceptance Criteria

1. WHEN 日記が保存される THEN システムは以下の情報をデータベースに記録する：ユーザーID、日記ID、日付、元の入力テキスト、生成された日記文章、作成日時、更新日時
2. WHERE データベース THE システムはユーザーごとに日記データを分離して保存する（Row Level Security）
3. WHEN ユーザーが認証されている THEN システムはそのユーザーの日記データのみにアクセスを許可する
4. IF ユーザーが未認証である THEN システムは日記データへのアクセスを拒否する
5. WHEN 日記が更新される THEN システムは更新日時フィールドを現在時刻に更新する

### Requirement 5: 日記一覧と閲覧
**Objective:** ユーザーとして、過去に作成した日記を簡単に閲覧したい。そうすることで、自分の記録を振り返ることができる。

#### Acceptance Criteria

1. WHEN ユーザーが日記一覧ページにアクセスした THEN システムはユーザーの日記を新しい順に表示する
2. WHERE 日記一覧 THE システムは各日記に対して日付、冒頭の100文字、日記カードを表示する
3. WHERE 日記一覧 THE システムはグリッドレイアウト（モバイル: 1列、タブレット: 2列、デスクトップ: 3列）で日記を表示する
4. WHEN ユーザーが日記カードをクリックした THEN システムは該当日記の詳細ページを表示する
5. WHERE 日記詳細ページ THE システムは日付、ユーザー入力メモ、完全な日記内容、作成日時、更新日時、「編集」ボタン、「削除」ボタンを表示する
6. WHERE 日記詳細ページ THE システムはユーザー入力メモを灰色の背景（bg-gray-50）で区別して表示する
7. IF 日記データが0件である THEN システムは「まだ日記がありません」というメッセージとアイコン、「最初の日記を作成」ボタンを表示する

### Requirement 6: 日記の編集と削除
**Objective:** ユーザーとして、作成済みの日記を編集・削除できるようにしたい。そうすることで、日記を最新の状態に保てる。

#### Acceptance Criteria

1. WHEN ユーザーが日記詳細ページで「編集」ボタンをクリックした THEN システムは編集ページに遷移する
2. WHERE 編集ページ THE システムは既存の日付、ユーザー入力、日記本文を入力済み状態で表示する
3. WHEN ユーザーが編集内容を保存した THEN システムは日記詳細ページにリダイレクトする
4. WHEN ユーザーが日記詳細ページで「削除」ボタンをクリックした THEN システムは削除確認モーダルを表示する
5. WHEN ユーザーが削除を確認した THEN システムは日記を削除し、日記一覧ページにリダイレクトする
6. IF 削除が失敗した THEN システムはエラーメッセージを表示する

### Requirement 7: ユーザー認証とセキュリティ
**Objective:** ユーザーとして、自分の日記データが安全に保護されることを保証してほしい。そうすることで、安心してプライベートな情報を記録できる。

#### Acceptance Criteria

1. WHEN ユーザーが日記関連ページにアクセスしようとした AND 未認証である THEN システムはログインページにリダイレクトする
2. WHEN ユーザーがログインに成功した THEN システムはセッションを確立し、日記機能へのアクセスを許可する
3. WHERE データベース THE システムはRow Level Security (RLS)ポリシーを適用し、ユーザーは自分の日記のみにアクセスできる
4. WHEN ユーザーが他のユーザーの日記IDを直接URLに入力した THEN システムはアクセスを拒否し、日記一覧ページにリダイレクトする
5. WHERE AI API通信 THE システムはHTTPSを使用して暗号化通信を行う
6. WHERE 認証済みページ THE システムはミドルウェアによる認証チェックを実行する

### Requirement 8: レスポンシブ対応とUI/UX
**Objective:** ユーザーとして、どのデバイスからでも快適に日記を作成・閲覧したい。そうすることで、場所を選ばず日記習慣を継続できる。

#### Acceptance Criteria

1. WHERE モバイルデバイス（画面幅768px未満） THE システムはモバイル最適化レイアウトを表示する
2. WHERE タブレット・デスクトップ（画面幅768px以上） THE システムはマルチカラムレイアウトを表示する
3. WHEN ユーザーがボタンをタップ/クリックした THEN システムは視覚的フィードバック（ホバー、アクティブ状態）を提供する
4. WHERE すべてのページ THE システムはTailwind CSSのデザインシステムに基づいた一貫したスタイルを適用する
5. WHERE UIコンポーネント THE システムは再利用可能なコンポーネント（Button, Input, Textarea, Card, Spinner, Modal）を使用する

### Requirement 9: パフォーマンスと信頼性
**Objective:** システムとして、高速で信頼性の高いサービスを提供したい。そうすることで、ユーザー体験を損なわない。

#### Acceptance Criteria

1. WHEN ユーザーがページ遷移を行った THEN システムはNext.js App Routerによる高速な遷移を提供する
2. WHEN AI生成リクエストが送信された THEN システムは30秒以内に生成結果を返す、またはタイムアウトエラーを表示する
3. WHERE AI生成サービス THE システムは処理時間を1秒単位でカウントし、15秒以上経過時に表示する
4. WHEN データベース操作が完了した THEN システムはrevalidatePath()によりキャッシュを適切に更新する
5. WHERE すべてのAPI呼び出し THE システムは適切なエラーハンドリング（ValidationError, AIGenerationError, AuthenticationError）を実装する
6. WHERE AI生成サービス THE システムは生成結果の品質チェック（500〜1000文字）を実行する
